---
import BaseLayout from "../../../layouts/BaseLayout.astro";
import { getServices } from "../../../data/services";
import { getLangFromUrl, useTranslations } from "../../../i18n/utils";
import { getRouteUrl } from "../../../i18n/path";

export async function getStaticPaths() {
  const services = getServices("en"); // ‚Üê hanya ID
  const paths = [];

  for (const service of services) {
    for (const item of service.items) {
      paths.push({
        params: { slug: item.slug },
        props: { service, item },
      });
    }
  }

  return paths;
}

const { service, item } = Astro.props;
const lang = getLangFromUrl(Astro.url); // akan return "id"
const t = useTranslations(lang);

const title = `${item.name} - Padang Eye Center`;
const description = service.description || service.category;
const permalink = `${Astro.site?.href}layanan/${item.slug}`;

const iconMap = { eye: "üëÅÔ∏è", shield: "üõ°Ô∏è", spark: "‚ú®" };
const colorMap = {
  orange: "#ea580c",
  green: "#16a34a",
  gradient: "#3b82f6",
};
---

<BaseLayout
  title={title}
  description={description}
  permalink={permalink}
  current="services">
  <div class="service-detail-wrapper relative overflow-hidden py-12 md:py-20">
    <div class="max-w-4xl mx-auto px-4 relative z-10">
      <!-- Back Button -->
      <a
        href={getRouteUrl(lang, "services")}
        class="back-btn inline-flex items-center gap-2 text-sm mb-10">
        <svg
          class="w-4 h-4"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M15 19l-7-7 7-7"></path>
        </svg>
        {t("nav.services")}
      </a>

      <!-- Hero Header -->
      <div class="hero-header text-center mb-14">
        <!-- Icon Badge -->
        <div
          class="icon-wrap mx-auto mb-6"
          style={`--accent: ${colorMap[service.color]};`}>
          <span class="text-4xl">{iconMap[service.icon]}</span>
          <div class="icon-ring"></div>
        </div>

        <!-- Category Pill -->
        <div
          class="category-pill inline-flex items-center gap-2 mb-5"
          style={`--accent: ${colorMap[service.color]};`}>
          <span class="pill-dot"></span>
          {service.category}
        </div>

        <!-- Title -->
        <h1 class="page-title mb-6">
          {item.name}
        </h1>

        <!-- Description -->
        {
          item.description && (
            <p class="page-desc max-w-2xl mx-auto">{item.description}</p>
          )
        }
      </div>

      <!-- Content Card -->
      <div class="content-card rounded-3xl p-8 md:p-10">
        <!-- Related Services -->
        {
          service.items.length > 1 && (
            <div>
              <div class="flex items-center gap-3 mb-6">
                <div
                  class="section-line"
                  style={`--accent: ${colorMap[service.color]};`}
                />
                <h3 class="section-title">Layanan Terkait</h3>
              </div>

              <ul class="grid grid-cols-1 md:grid-cols-2 gap-3">
                {service.items
                  .filter((relatedItem) => relatedItem.slug !== item.slug)
                  .map((relatedItem) => (
                    <li>
                      <a
                        href={`${getRouteUrl(lang, "services")}/${relatedItem.slug}`}
                        class="related-item flex items-center gap-3 p-4 rounded-2xl transition-all group"
                        style={`--accent: ${colorMap[service.color]};`}>
                        <div class="related-icon">
                          <svg
                            class="w-4 h-4"
                            style={`color: ${colorMap[service.color]}`}
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24">
                            <path
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              stroke-width="2.5"
                              d="M13 7l5 5m0 0l-5 5m5-5H6"
                            />
                          </svg>
                        </div>
                        <span class="related-name text-sm font-semibold">
                          {relatedItem.name}
                        </span>
                      </a>
                    </li>
                  ))}
              </ul>
            </div>
          )
        }
      </div>
    </div>
  </div>

  <style>
    .service-detail-wrapper {
      min-height: 70vh;
    }

    /* Blobs */
    .blob {
      position: absolute;
      border-radius: 50%;
      filter: blur(80px);
      opacity: 0.12;
      pointer-events: none;
    }

    @keyframes drift {
      0%,
      100% {
        transform: translate(0, 0);
      }
      50% {
        transform: translate(30px, -30px);
      }
    }

    /* Back Button */
    .back-btn {
      color: var(--text-muted);
      transition: all 0.2s ease;
      font-weight: 500;
    }

    .back-btn:hover {
      color: var(--text-main);
      transform: translateX(-3px);
    }

    /* Icon Wrap */
    .icon-wrap {
      position: relative;
      width: 88px;
      height: 88px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 24px;
      background: linear-gradient(
        135deg,
        var(--accent),
        color-mix(in srgb, var(--accent) 60%, transparent)
      );
      box-shadow: 0 12px 40px -8px
        color-mix(in srgb, var(--accent) 50%, transparent);
    }

    .icon-ring {
      position: absolute;
      inset: -6px;
      border-radius: 28px;
      border: 2px solid color-mix(in srgb, var(--accent) 25%, transparent);
      animation: pulse-ring 3s ease-in-out infinite;
    }

    @keyframes pulse-ring {
      0%,
      100% {
        opacity: 0.5;
        transform: scale(1);
      }
      50% {
        opacity: 1;
        transform: scale(1.04);
      }
    }

    /* Category Pill */
    .category-pill {
      padding: 6px 16px;
      border-radius: 9999px;
      background: color-mix(in srgb, var(--accent) 12%, transparent);
      border: 1px solid color-mix(in srgb, var(--accent) 30%, transparent);
      font-size: 0.75rem;
      font-weight: 600;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      color: var(--accent);
    }

    .pill-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--accent);
      animation: blink 2s ease-in-out infinite;
    }

    @keyframes blink {
      0%,
      100% {
        opacity: 1;
      }
      50% {
        opacity: 0.3;
      }
    }

    /* Title */
    .page-title {
      font-size: clamp(2rem, 5vw, 3.25rem);
      font-weight: 800;
      line-height: 1.1;
      letter-spacing: -0.02em;
      color: var(--text-main);
    }

    /* Description */
    .page-desc {
      font-size: 1.0625rem;
      line-height: 1.75;
      color: var(--text-muted);
      text-align: justify;
    }

    /* Content Card */
    .content-card {
      background: var(--background-body);
      border: 1px solid rgba(0, 0, 0, 0.07);
      box-shadow:
        0 1px 0 rgba(255, 255, 255, 0.6) inset,
        0 20px 50px -12px rgba(0, 0, 0, 0.08);
    }

    :root.theme-dark .content-card {
      border-color: rgba(255, 255, 255, 0.07);
      box-shadow: 0 20px 50px -12px rgba(0, 0, 0, 0.4);
    }

    /* Section Header */
    .section-line {
      width: 4px;
      height: 22px;
      border-radius: 9999px;
      background: var(--accent);
    }

    .section-title {
      font-size: 1.0625rem;
      font-weight: 700;
      color: var(--text-main);
    }

    /* Related Items */
    .related-item {
      border: 1px solid rgba(0, 0, 0, 0.06);
      background: transparent;
    }

    :root.theme-dark .related-item {
      border-color: rgba(255, 255, 255, 0.06);
    }

    .related-item:hover {
      background: color-mix(in srgb, var(--accent) 8%, transparent);
      border-color: color-mix(in srgb, var(--accent) 30%, transparent);
      transform: translateX(4px);
    }

    .related-icon {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      background: color-mix(in srgb, var(--accent) 10%, transparent);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      transition: background 0.2s;
    }

    .related-item:hover .related-icon {
      background: color-mix(in srgb, var(--accent) 20%, transparent);
    }

    .related-name {
      color: var(--text-main);
      transition: color 0.2s;
    }
  </style>
</BaseLayout>
