---
import { getServices } from "../../data/services";
import ServiceCard from "../cards/ServiceCard.astro";
import { getLangFromUrl, useTranslations } from "../../i18n/utils";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const services = getServices(lang as any);
---

<section class="py-20 relative bg-transparent overflow-hidden">
  <div class="max-w-7xl mx-auto px-6 mb-12 relative z-10">
    <div class="flex flex-col md:flex-row md:items-end justify-between gap-6">
      <div>
        <h2
          class="text-6xl md:text-7xl font-[1000] tracking-tighter leading-none uppercase text-gray-900 dark:text-white">
          {t("services.title").split(" ")[0]}<br />
          <span
            class="bg-gradient-to-r from-orange-600 to-green-600 bg-clip-text text-transparent"
            >{t("services.title").split(" ").slice(1).join(" ")}</span
          >
        </h2>
      </div>
      <p
        class="text-lg italic font-bold uppercase tracking-tighter leading-tight max-w-[280px]"
        style="color: var(--text-secondary);">
        {t("services.subtitle")}
      </p>
    </div>
  </div>

  <div class="relative group/nav">
    <div
      id="serviceScroll"
      class="flex gap-4 overflow-x-auto snap-x snap-mandatory px-[5vw] md:px-[calc((100vw-1200px)/2)] no-scrollbar scroll-smooth pb-12">
      {services.map((svc) => <ServiceCard {...svc} />)}
    </div>

    <div
      class="absolute top-1/2 -translate-y-1/2 w-full hidden md:flex justify-between px-6 pointer-events-none z-30">
      <button
        id="sPrev"
        class="pointer-events-auto w-14 h-14 rounded-full border border-black/10 dark:border-white/20 bg-white/80 dark:bg-white/5 backdrop-blur-xl flex items-center justify-center text-gray-800 dark:text-white hover:bg-orange-600 hover:text-white transition-all shadow-xl">
        <svg
          class="w-6 h-6"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          ><path stroke-width="2.5" d="M15 19l-7-7 7-7"></path></svg
        >
      </button>
      <button
        id="sNext"
        class="pointer-events-auto w-14 h-14 rounded-full border border-black/10 dark:border-white/20 bg-white/80 dark:bg-white/5 backdrop-blur-xl flex items-center justify-center text-gray-800 dark:text-white hover:bg-green-600 hover:text-white transition-all shadow-xl">
        <svg
          class="w-6 h-6"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          ><path stroke-width="2.5" d="M9 5l7 7-7 7"></path></svg
        >
      </button>
    </div>

    <div class="flex justify-center gap-3 mt-4">
      {
        services.map((_, i) => (
          <div
            class={`s-dot h-[3px] w-8 rounded-full bg-gray-300 dark:bg-white transition-all duration-500 ${i === 0 ? "opacity-100 bg-orange-600 w-16" : "opacity-30"}`}
          />
        ))
      }
    </div>
  </div>
</section>

<style>
  /* HIDE SCROLLBAR COMPLETELY */
  .no-scrollbar::-webkit-scrollbar {
    display: none;
  }
  .no-scrollbar {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
</style>

<script>
  function initServiceCompact() {
    const container = document.getElementById("serviceScroll");
    const nextBtn = document.getElementById("sNext");
    const prevBtn = document.getElementById("sPrev");
    const dots = document.querySelectorAll(".s-dot");

    if (!container || !nextBtn || !prevBtn) return;

    const step = () => {
      const card = container.querySelector(".snap-center") as HTMLElement;
      return card ? card.offsetWidth + 16 : 400;
    };

    nextBtn.onclick = () =>
      container.scrollBy({ left: step(), behavior: "smooth" });
    prevBtn.onclick = () =>
      container.scrollBy({ left: -step(), behavior: "smooth" });

    container.onscroll = () => {
      const index = Math.round(container.scrollLeft / step());
      dots.forEach((dot, i) => {
        dot.classList.toggle("opacity-100", i === index);
        dot.classList.toggle("bg-orange-600", i === index);
        dot.classList.toggle("w-16", i === index);
        dot.classList.toggle("opacity-30", i !== index);
        dot.classList.toggle("w-8", i !== index);
      });
    };
  }
  document.addEventListener("astro:page-load", initServiceCompact);
</script>
